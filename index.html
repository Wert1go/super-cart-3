<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ö–æ—Ä–∑–∏–Ω–∞ ‚Äî –Ø–Ω–¥–µ–∫—Å –õ–∞–≤–∫–∞</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /* ===== CSS Variables (Design Tokens) ===== */
    :root {
      --color-bg-primary: #f4f4f4;
      --color-bg-surface: #ffffff;
      --color-bg-elevated: #fefefe;
      --color-bg-yellow: #fce001;
      --color-bg-yellow-border: #f4e550;
      --color-bg-control: #eeedec;
      
      --color-text-primary: #393939;
      --color-text-secondary: #666666;
      --color-text-tertiary: #b8b8b8;
      --color-text-muted: #b3b3b3;
      --color-text-accent: #71c28f;
      --color-text-button: #52430c;
      --color-text-button-secondary: #68580d;
      
      --color-separator: #e3e3e3;
      --color-border-default: #e6e6e6;
      --color-border-active: #434343;
      --color-badge-cart: #fbbaa3;
      
      --font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      
      --radius-sm: 15px;
      --radius-md: 16px;
      --radius-lg: 22px;
      --radius-xl: 23px;
      --radius-device: 55px;
      
      --safe-area-top: 47px;
      --safe-area-bottom: 34px;
    }

    /* ===== Reset & Base ===== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      height: 100%;
      overflow: hidden;
    }

    body {
      font-family: var(--font-family);
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      -webkit-font-smoothing: antialiased;
    }

    /* ===== Device Scale Wrapper ===== */
    .device-scale-wrapper {
      /* Scale is set dynamically via JavaScript */
      transform-origin: center center;
      -moz-transform-origin: center center;
    }

    /* ===== App Viewport (Device Frame) ===== */
    .app-viewport {
      width: 428px;
      height: 926px;
      background: var(--color-bg-primary);
      border-radius: var(--radius-device);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      box-shadow: 
        0 50px 100px rgba(0, 0, 0, 0.4),
        0 0 0 12px #1a1a1a,
        0 0 0 14px #333,
        inset 0 0 2px rgba(255, 255, 255, 0.1);
      position: relative;
    }

    /* ===== Safe Area Top ===== */
    .safe-area-top {
      height: var(--safe-area-top);
      background: var(--color-bg-primary);
      flex-shrink: 0;
    }

    /* ===== Status Bar ===== */
    .status-bar {
      height: 20px;
      padding: 0 28px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: var(--color-bg-primary);
      flex-shrink: 0;
    }

    .status-bar__time {
      font-size: 17px;
      font-weight: 600;
      color: var(--color-text-primary);
    }

    .status-bar__right {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .status-bar__signal {
      height: 14px;
      width: auto;
    }

    .status-bar__network {
      font-size: 13px;
      font-weight: 400;
      color: #474747;
    }

    .status-bar__battery {
      height: 14px;
      width: auto;
    }

    /* ===== Header ===== */
    .header {
      height: 53px;
      padding: 0 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      background: var(--color-bg-primary);
      flex-shrink: 0;
    }

    .header__title {
      font-size: 17px;
      font-weight: 500;
      color: #505050;
    }

    .header__actions {
      position: absolute;
      right: 20px;
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .header__action {
      width: 24px;
      height: 24px;
      cursor: pointer;
      opacity: 0.7;
      transition: opacity 0.2s;
    }

    .header__action:hover {
      opacity: 1;
    }

    /* ===== Scrollable Content Area ===== */
    .content-area {
      flex: 1;
      overflow-y: auto;
      overflow-x: hidden;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
    }

    .content-area::-webkit-scrollbar {
      display: none;
    }

    /* ===== Store Selector ===== */
    .store-selector {
      padding: 12px 16px;
      display: flex;
      gap: 8px;
    }

    .store-button {
      flex: 1;
      background: var(--color-bg-elevated);
      border-radius: var(--radius-lg);
      padding: 14px 18px;
      cursor: pointer;
      transition: all 0.2s;
      border: 1px solid var(--color-border-default);
    }

    .store-button--active {
      border: 2px solid var(--color-border-active);
    }

    .store-button__name {
      font-size: 16px;
      font-weight: 500;
      color: #565656;
      margin-bottom: 4px;
    }

    .store-button__time {
      font-size: 14px;
      font-weight: 400;
      color: var(--color-text-muted);
    }

    /* ===== Delivery Summary ===== */
    .delivery-summary {
      padding: 16px 20px;
    }

    .delivery-summary__header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
    }

    .delivery-summary__main {
      font-size: 21px;
      font-weight: 600;
      color: var(--color-text-primary);
    }

    .delivery-summary__info-btn {
      width: 35px;
      height: 35px;
      cursor: pointer;
      opacity: 0.8;
      transition: opacity 0.2s;
    }

    .delivery-summary__info-btn:hover {
      opacity: 1;
    }

    .delivery-summary__subtitle {
      font-size: 13px;
      color: var(--color-text-tertiary);
      margin-bottom: 10px;
    }

    .delivery-summary__progress {
      position: relative;
      margin-bottom: 6px;
    }

    .delivery-summary__progress-bar {
      width: 100%;
      height: 8px;
      border-radius: 4px;
    }

    .delivery-summary__progress-labels {
      display: flex;
      justify-content: space-between;
    }

    .delivery-summary__progress-label {
      font-size: 11px;
      color: var(--color-text-accent);
    }

    .delivery-summary__progress-label--end {
      color: #606060;
    }

    /* ===== Cart Items ===== */
    .cart-items {
      background: var(--color-bg-surface);
      margin: 0 16px;
      border-radius: var(--radius-md);
      overflow: hidden;
    }

    .cart-item {
      display: flex;
      align-items: center;
      padding: 12px 16px;
      gap: 12px;
    }

    .cart-item + .cart-item {
      border-top: 1px solid var(--color-separator);
    }

    .cart-item__image {
      width: 70px;
      height: 70px;
      object-fit: cover;
      border-radius: 8px;
    }

    .cart-item__info {
      flex: 1;
      min-width: 0;
    }

    .cart-item__name {
      font-size: 13px;
      font-weight: 400;
      color: var(--color-text-secondary);
      line-height: 1.3;
      margin-bottom: 6px;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .cart-item__meta {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .cart-item__price {
      font-size: 14px;
      font-weight: 700;
      color: #535353;
    }

    .cart-item__weight {
      font-size: 13px;
      color: var(--color-text-tertiary);
    }

    /* ===== Quantity Controller ===== */
    .quantity-controller {
      display: flex;
      align-items: center;
      background: var(--color-bg-control);
      border-radius: var(--radius-sm);
      padding: 8px 12px;
      gap: 16px;
    }

    .quantity-controller__btn {
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      opacity: 0.7;
      transition: opacity 0.2s;
    }

    .quantity-controller__btn:hover {
      opacity: 1;
    }

    .quantity-controller__btn img {
      width: 14px;
      height: auto;
    }

    .quantity-controller__value {
      font-size: 14px;
      font-weight: 400;
      color: #42413f;
      min-width: 16px;
      text-align: center;
    }

    /* ===== Recommendations ===== */
    .recommendations {
      margin-top: 8px;
      padding: 20px 16px;
      background: var(--color-bg-surface);
    }

    .recommendations__title {
      font-size: 20px;
      font-weight: 600;
      color: #3a3a39;
      margin-bottom: 16px;
    }

    .recommendations__list {
      display: flex;
      gap: 8px;
      overflow-x: auto;
      scrollbar-width: none;
      padding-bottom: 4px;
    }

    .recommendations__list::-webkit-scrollbar {
      display: none;
    }

    .recommended-product {
      flex-shrink: 0;
      width: 95px;
      position: relative;
    }

    .recommended-product__image-wrapper {
      position: relative;
      margin-bottom: 8px;
    }

    .recommended-product__image {
      width: 95px;
      height: 90px;
      object-fit: cover;
      border-radius: 12px;
    }

    .recommended-product__add {
      position: absolute;
      bottom: 4px;
      right: 4px;
      width: 28px;
      height: 28px;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .recommended-product__add:hover {
      transform: scale(1.1);
    }

    .recommended-product__price {
      font-size: 13px;
      font-weight: 600;
      color: var(--color-text-secondary);
    }

    /* ===== Bottom Block (Fixed) ===== */
    .bottom-block {
      background: var(--color-bg-surface);
      border-top: 1px solid var(--color-separator);
      flex-shrink: 0;
    }

    /* ===== Checkout Block ===== */
    .checkout-block {
      padding: 14px 16px;
    }

    /* ===== Discount Section ===== */
    .discount-section {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 14px;
    }

    .discount-section__left {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .discount-section__icon-wrapper {
      position: relative;
    }

    .discount-section__icon {
      width: 35px;
      height: 24px;
    }

    .discount-section__badge {
      position: absolute;
      top: -8px;
      right: -6px;
      background: #eeedec;
      border-radius: 6px;
      padding: 2px 4px;
      font-size: 11px;
      color: #656665;
    }

    .discount-section__info {
      flex: 1;
    }

    .discount-section__text {
      font-size: 16px;
      font-weight: 500;
      color: #404040;
      margin-bottom: 2px;
    }

    .discount-section__promo {
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 13px;
      color: var(--color-text-muted);
      cursor: pointer;
    }

    .discount-section__promo-arrow {
      width: 6px;
      height: 10px;
    }

    .discount-section__toggle {
      width: 46px;
      height: 28px;
      cursor: pointer;
    }

    /* ===== Checkout Button ===== */
    .checkout-button {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: var(--color-bg-yellow);
      border: 1px solid var(--color-bg-yellow-border);
      border-radius: var(--radius-xl);
      padding: 18px 20px;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .checkout-button:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(252, 224, 1, 0.3);
    }

    .checkout-button:active {
      transform: translateY(0);
    }

    .checkout-button__time {
      font-size: 18px;
      font-weight: 400;
      color: #634d0c;
    }

    .checkout-button__label {
      font-size: 17px;
      font-weight: 500;
      color: var(--color-text-button-secondary);
    }

    .checkout-button__total {
      font-size: 18px;
      font-weight: 700;
      color: var(--color-text-button);
    }

    /* ===== Tab Bar ===== */
    .tabbar {
      display: flex;
      justify-content: space-around;
      align-items: center;
      padding: 8px 0 4px;
      background: var(--color-bg-surface);
    }

    .tabbar__item {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 8px 24px;
      cursor: pointer;
      position: relative;
      opacity: 0.5;
      transition: opacity 0.2s;
    }

    .tabbar__item:hover {
      opacity: 0.8;
    }

    .tabbar__item--active {
      opacity: 1;
    }

    .tabbar__icon {
      width: 24px;
      height: 24px;
    }

    .tabbar__badge {
      position: absolute;
      top: 4px;
      right: 16px;
      min-width: 18px;
      height: 18px;
      border-radius: 9px;
      background: #ff6b47;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      font-weight: 600;
      color: white;
      padding: 0 4px;
    }

    /* ===== Safe Area Bottom ===== */
    .safe-area-bottom {
      height: var(--safe-area-bottom);
      background: var(--color-bg-surface);
      flex-shrink: 0;
    }

    /* ===== Home Indicator ===== */
    .home-indicator {
      width: 134px;
      height: 5px;
      background: #1a1a1a;
      border-radius: 3px;
      margin: 8px auto 0;
    }
  </style>
</head>
<body>
  <div class="device-scale-wrapper">
    <div class="app-viewport">
      
      <!-- ===== FIXED TOP ===== -->
      <div class="safe-area-top"></div>
      
      <!-- Status Bar -->
      <div class="status-bar">
        <span class="status-bar__time">1:09</span>
        <div class="status-bar__right">
          <img class="status-bar__signal" src="Assets/figma/icons/signal-icon.png" alt="signal">
          <span class="status-bar__network">LTE</span>
          <img class="status-bar__battery" src="Assets/figma/icons/battery-icon.png" alt="battery">
        </div>
      </div>
      
      <!-- Header -->
      <header class="header">
        <h1 class="header__title">–ö–æ—Ä–∑–∏–Ω–∞</h1>
        <div class="header__actions">
          <img class="header__action" src="Assets/figma/icons/share-icon.png" alt="share">
          <img class="header__action" src="Assets/figma/icons/search-icon.png" alt="search">
          <img class="header__action" src="Assets/figma/icons/trash-icon.png" alt="trash">
        </div>
      </header>
      
      <!-- ===== SCROLLABLE CONTENT ===== -->
      <div class="content-area">
        
        <!-- Store Selector -->
        <div class="store-selector">
          <div class="store-button">
            <div class="store-button__name">–õ–∞–≤–∫–∞ —É –¥–æ–º–∞</div>
            <div class="store-button__time">15-30 –º–∏–Ω</div>
          </div>
          <div class="store-button store-button--active">
            <div class="store-button__name">–ë–æ–ª—å—à–∞—è –õ–∞–≤–∫–∞</div>
            <div class="store-button__time">60-90 –º–∏–Ω</div>
          </div>
        </div>
        
        <!-- Delivery Summary -->
        <div class="delivery-summary">
          <div class="delivery-summary__header">
            <span class="delivery-summary__main">60-90 –º–∏–Ω, 249 —Ä</span>
            <img class="delivery-summary__info-btn" src="Assets/figma/icons/delivery-info-icon.png" alt="info">
          </div>
          <div class="delivery-summary__subtitle">–î–æ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ 2 302 —Ä</div>
          <div class="delivery-summary__progress">
            <img class="delivery-summary__progress-bar" src="Assets/figma/components/delivery-progress-bar.png" alt="progress">
          </div>
          <div class="delivery-summary__progress-labels">
            <span class="delivery-summary__progress-label">249–†</span>
            <span class="delivery-summary__progress-label delivery-summary__progress-label--end">0–†</span>
          </div>
        </div>
        
        <!-- Cart Items -->
        <div class="cart-items">
          <!-- Product 1 -->
          <div class="cart-item">
            <img class="cart-item__image" src="Assets/figma/components/product-ice-cream.png" alt="–ú–æ—Ä–æ–∂–µ–Ω–æ–µ">
            <div class="cart-item__info">
              <div class="cart-item__name">–ú–æ—Ä–æ–∂–µ–Ω–æ–µ –º–∏–Ω–¥–∞–ª—å–Ω–æ–µ –ò–∑ –õ–∞–≤–∫–∏ —Å –ø–µ—á–µ–Ω—å–µ–º</div>
              <div class="cart-item__meta">
                <span class="cart-item__price">499–†</span>
                <span class="cart-item__weight">330–ì</span>
              </div>
            </div>
            <div class="quantity-controller">
              <div class="quantity-controller__btn">
                <img src="Assets/figma/icons/minus-icon.png" alt="minus">
              </div>
              <span class="quantity-controller__value">1</span>
              <div class="quantity-controller__btn">
                <img src="Assets/figma/icons/plus-icon.png" alt="plus">
              </div>
            </div>
          </div>
          
          <!-- Product 2 -->
          <div class="cart-item">
            <img class="cart-item__image" src="Assets/figma/components/product-drink.png" alt="–ù–∞–ø–∏—Ç–æ–∫">
            <div class="cart-item__info">
              <div class="cart-item__name">–ù–∞–ø–∏—Ç–æ–∫ Drive Me Max –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π</div>
              <div class="cart-item__meta">
                <span class="cart-item__price">99–†</span>
                <span class="cart-item__weight">449 –º–ª</span>
              </div>
            </div>
            <div class="quantity-controller">
              <div class="quantity-controller__btn">
                <img src="Assets/figma/icons/minus-icon-2.png" alt="minus">
              </div>
              <span class="quantity-controller__value">1</span>
              <div class="quantity-controller__btn">
                <img src="Assets/figma/icons/plus-icon-2.png" alt="plus">
              </div>
            </div>
          </div>
        </div>
        
        <!-- Recommendations -->
        <div class="recommendations">
          <h2 class="recommendations__title">–ü–æ—Ä–∞–¥–æ–≤–∞—Ç—å —Å–µ–±—è</h2>
          <div class="recommendations__list">
            <div class="recommended-product">
              <div class="recommended-product__image-wrapper">
                <img class="recommended-product__image" src="Assets/figma/components/recommended-product-1.png" alt="Product">
                <img class="recommended-product__add" src="Assets/figma/icons/add-button-1.png" alt="Add">
              </div>
              <span class="recommended-product__price">279–†</span>
            </div>
            <div class="recommended-product">
              <div class="recommended-product__image-wrapper">
                <img class="recommended-product__image" src="Assets/figma/components/recommended-product-2.png" alt="Product">
                <img class="recommended-product__add" src="Assets/figma/icons/add-button-2.png" alt="Add">
              </div>
              <span class="recommended-product__price">238–†</span>
            </div>
            <div class="recommended-product">
              <div class="recommended-product__image-wrapper">
                <img class="recommended-product__image" src="Assets/figma/components/recommended-product-3.png" alt="Product">
                <img class="recommended-product__add" src="Assets/figma/icons/add-button-3.png" alt="Add">
              </div>
              <span class="recommended-product__price">50–†</span>
            </div>
            <div class="recommended-product">
              <div class="recommended-product__image-wrapper">
                <img class="recommended-product__image" src="Assets/figma/components/recommended-product-4.png" alt="Product">
                <img class="recommended-product__add" src="Assets/figma/icons/add-button-4.png" alt="Add">
              </div>
              <span class="recommended-product__price">159–†</span>
            </div>
            <div class="recommended-product">
              <div class="recommended-product__image-wrapper">
                <img class="recommended-product__image" src="Assets/figma/components/recommended-product-5.png" alt="Product">
                <img class="recommended-product__add" src="Assets/figma/icons/add-button-5.png" alt="Add">
              </div>
              <span class="recommended-product__price">109–†</span>
            </div>
          </div>
        </div>
        
      </div>
      
      <!-- ===== FIXED BOTTOM ===== -->
      <div class="bottom-block">
        <!-- Checkout Block -->
        <div class="checkout-block">
          <!-- Discount Section -->
          <div class="discount-section">
            <div class="discount-section__left">
              <div class="discount-section__icon-wrapper">
                <img class="discount-section__icon" src="Assets/figma/icons/discount-icon.png" alt="discount">
                <span class="discount-section__badge">+6</span>
              </div>
              <div class="discount-section__info">
                <div class="discount-section__text">200 –† –ø—Ä–∏ –∑–∞–∫–∞–∑–µ –æ—Ç 2500 –†</div>
                <div class="discount-section__promo">
                  –î—Ä—É–≥–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥—ã
                  <img class="discount-section__promo-arrow" src="Assets/figma/icons/more-info-icon.png" alt="more">
                </div>
              </div>
            </div>
            <img class="discount-section__toggle" src="Assets/figma/icons/toggle-icon.png" alt="toggle">
          </div>
          
          <!-- Checkout Button -->
          <div class="checkout-button">
            <span class="checkout-button__time">60-90 –º–∏–Ω</span>
            <span class="checkout-button__label">–ö –æ–ø–ª–∞—Ç–µ</span>
            <span class="checkout-button__total">847</span>
          </div>
        </div>
        
        <!-- Tab Bar -->
        <nav class="tabbar">
          <div class="tabbar__item">
            <img class="tabbar__icon" src="Assets/figma/icons/lavka-tab-icon.png" alt="–õ–∞–≤–∫–∞">
          </div>
          <div class="tabbar__item">
            <img class="tabbar__icon" src="Assets/figma/icons/grocery-tab-icon.png" alt="–ü—Ä–æ–¥—É–∫—Ç—ã">
          </div>
          <div class="tabbar__item">
            <img class="tabbar__icon" src="Assets/figma/icons/food-tab-icon.png" alt="–ï–¥–∞">
          </div>
          <div class="tabbar__item tabbar__item--active">
            <img class="tabbar__icon" src="Assets/figma/icons/cart-tab-icon.png" alt="–ö–æ—Ä–∑–∏–Ω–∞">
            <span class="tabbar__badge">2</span>
          </div>
        </nav>
        
        <!-- Safe Area Bottom -->
        <div class="safe-area-bottom">
          <div class="home-indicator"></div>
        </div>
      </div>
      
    </div>
  </div>

  <script>
    // ===== Business Logic =====
    const FREE_DELIVERY_THRESHOLD = 2551;
    const BASE_DELIVERY_PRICE = 249;
    const DISCOUNT_MIN_ORDER = 2500;
    const DISCOUNT_AMOUNT = 200;

    // State
    let cartItems = [
      { id: 'product-1', name: '–ú–æ—Ä–æ–∂–µ–Ω–æ–µ –º–∏–Ω–¥–∞–ª—å–Ω–æ–µ –ò–∑ –õ–∞–≤–∫–∏ —Å –ø–µ—á–µ–Ω—å–µ–º', price: 499, weight: '330–ì', quantity: 1, image: 'Assets/figma/components/product-ice-cream.png' },
      { id: 'product-2', name: '–ù–∞–ø–∏—Ç–æ–∫ Drive Me Max –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π', price: 99, weight: '449 –º–ª', quantity: 1, image: 'Assets/figma/components/product-drink.png' }
    ];

    let selectedStore = 'big-store';
    let discountEnabled = false;

    const recommendations = [
      { id: 'rec-1', name: '–°–Ω–∏–∫–µ—Ä—Å', price: 279, image: 'Assets/figma/components/recommended-product-1.png' },
      { id: 'rec-2', name: 'M&Ms', price: 238, image: 'Assets/figma/components/recommended-product-2.png' },
      { id: 'rec-3', name: 'Orbit', price: 50, image: 'Assets/figma/components/recommended-product-3.png' },
      { id: 'rec-4', name: 'M&Ms –±–æ–ª—å—à–æ–π', price: 159, image: 'Assets/figma/components/recommended-product-4.png' },
      { id: 'rec-5', name: '–°—É—Ö–∞—Ä–∏–∫–∏', price: 109, image: 'Assets/figma/components/recommended-product-5.png' }
    ];

    const stores = {
      'small-store': { name: '–õ–∞–≤–∫–∞ —É –¥–æ–º–∞', time: '15-30 –º–∏–Ω' },
      'big-store': { name: '–ë–æ–ª—å—à–∞—è –õ–∞–≤–∫–∞', time: '60-90 –º–∏–Ω' }
    };

    // Utility
    const formatPrice = (price) => `${price}‚ÇΩ`;

    // Calculations
    const getSubtotal = () => cartItems.reduce((sum, item) => sum + item.price * item.quantity, 0);
    const getTotalItems = () => cartItems.reduce((sum, item) => sum + item.quantity, 0);
    const getDeliveryPrice = () => getSubtotal() >= FREE_DELIVERY_THRESHOLD ? 0 : BASE_DELIVERY_PRICE;
    const canApplyDiscount = () => getSubtotal() >= DISCOUNT_MIN_ORDER;
    const getAppliedDiscount = () => (discountEnabled && canApplyDiscount()) ? DISCOUNT_AMOUNT : 0;
    const getTotalPrice = () => getSubtotal() + getDeliveryPrice() - getAppliedDiscount();
    const getFreeDeliveryRemaining = () => Math.max(0, FREE_DELIVERY_THRESHOLD - getSubtotal());
    const getProgressPercent = () => Math.min(100, (getSubtotal() / FREE_DELIVERY_THRESHOLD) * 100);

    // Render Functions
    function renderCartItems() {
      const container = document.querySelector('.cart-items');
      if (cartItems.length === 0) {
        container.innerHTML = `
          <div class="cart-items__empty">
            <p>–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</p>
            <p class="cart-items__empty-hint">–î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã –∏–∑ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π</p>
          </div>
        `;
        return;
      }

      container.innerHTML = cartItems.map((item, index) => `
        <div class="cart-item" data-id="${item.id}">
          <img class="cart-item__image" src="${item.image}" alt="${item.name}">
          <div class="cart-item__info">
            <div class="cart-item__name">${item.name}</div>
            <div class="cart-item__meta">
              <span class="cart-item__price">${formatPrice(item.price * item.quantity)}</span>
              <span class="cart-item__weight">${item.weight}</span>
              ${item.quantity > 1 ? `<span class="cart-item__unit-price">(${formatPrice(item.price)} √ó ${item.quantity})</span>` : ''}
            </div>
          </div>
          <div class="quantity-controller">
            <div class="quantity-controller__btn" onclick="updateQuantity('${item.id}', ${item.quantity - 1})">
              <img src="Assets/figma/icons/minus-icon.png" alt="minus">
            </div>
            <span class="quantity-controller__value">${item.quantity}</span>
            <div class="quantity-controller__btn" onclick="updateQuantity('${item.id}', ${item.quantity + 1})">
              <img src="Assets/figma/icons/plus-icon.png" alt="plus">
            </div>
          </div>
        </div>
      `).join('');
    }

    function renderDeliverySummary() {
      const deliveryTime = stores[selectedStore].time;
      const deliveryPrice = getDeliveryPrice();
      const isFree = deliveryPrice === 0;
      const remaining = getFreeDeliveryRemaining();
      const progress = getProgressPercent();

      document.querySelector('.delivery-summary__main').textContent = 
        `${deliveryTime}, ${isFree ? '–±–µ—Å–ø–ª–∞—Ç–Ω–æ' : formatPrice(BASE_DELIVERY_PRICE)}`;
      
      document.querySelector('.delivery-summary__subtitle').textContent = 
        isFree ? 'üéâ –ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞!' : `–î–æ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ ${formatPrice(remaining)}`;

      const progressLabel = document.querySelector('.delivery-summary__progress-label');
      progressLabel.textContent = formatPrice(deliveryPrice);
      progressLabel.classList.toggle('delivery-summary__progress-label--success', isFree);

      // Update progress bar
      const progressContainer = document.querySelector('.delivery-summary__progress');
      progressContainer.innerHTML = `
        <div class="delivery-summary__progress-track">
          <div class="delivery-summary__progress-fill" style="width: ${progress}%"></div>
        </div>
      `;
    }

    function renderCheckout() {
      const deliveryTime = stores[selectedStore].time;
      const total = getTotalPrice();
      const itemsCount = getTotalItems();
      const canDiscount = canApplyDiscount();

      document.querySelector('.checkout-button__time').textContent = deliveryTime;
      document.querySelector('.checkout-button__total').textContent = formatPrice(total);

      const checkoutBtn = document.querySelector('.checkout-button');
      checkoutBtn.classList.toggle('checkout-button--disabled', itemsCount === 0);

      // Update discount section
      const discountSection = document.querySelector('.discount-section');
      discountSection.classList.toggle('discount-section--disabled', !canDiscount);

      const discountText = document.querySelector('.discount-section__text');
      discountText.textContent = (discountEnabled && canDiscount) 
        ? `‚àí${DISCOUNT_AMOUNT}‚ÇΩ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ` 
        : `${DISCOUNT_AMOUNT}‚ÇΩ –ø—Ä–∏ –∑–∞–∫–∞–∑–µ –æ—Ç ${DISCOUNT_MIN_ORDER}‚ÇΩ`;

      // Replace toggle image with custom toggle
      const toggleContainer = discountSection.querySelector('.discount-section__toggle');
      if (toggleContainer && toggleContainer.tagName === 'IMG') {
        const newToggle = document.createElement('div');
        newToggle.className = `discount-section__toggle-wrapper ${discountEnabled ? 'discount-section__toggle-wrapper--active' : ''}`;
        newToggle.innerHTML = '<div class="discount-section__toggle-track"><div class="discount-section__toggle-thumb"></div></div>';
        newToggle.onclick = toggleDiscount;
        toggleContainer.replaceWith(newToggle);
      } else if (toggleContainer) {
        toggleContainer.className = `discount-section__toggle-wrapper ${discountEnabled ? 'discount-section__toggle-wrapper--active' : ''}`;
      }
    }

    function renderHeader() {
      const itemsCount = getTotalItems();
      document.querySelector('.header__title').textContent = 
        `–ö–æ—Ä–∑–∏–Ω–∞${itemsCount > 0 ? ` (${itemsCount})` : ''}`;
    }

    function renderTabBar() {
      const badge = document.querySelector('.tabbar__badge');
      const count = getTotalItems();
      if (count > 0) {
        badge.textContent = count;
        badge.style.display = 'flex';
      } else {
        badge.style.display = 'none';
      }
    }

    function renderAll() {
      renderCartItems();
      renderDeliverySummary();
      renderCheckout();
      renderHeader();
      renderTabBar();
    }

    // Actions
    function updateQuantity(itemId, newQuantity) {
      if (newQuantity <= 0) {
        cartItems = cartItems.filter(item => item.id !== itemId);
      } else {
        cartItems = cartItems.map(item => 
          item.id === itemId ? { ...item, quantity: newQuantity } : item
        );
      }
      renderAll();
    }

    function addRecommendedProduct(recId) {
      const rec = recommendations.find(r => r.id === recId);
      if (!rec) return;

      const existing = cartItems.find(item => item.id === rec.id);
      if (existing) {
        updateQuantity(rec.id, existing.quantity + 1);
      } else {
        cartItems.push({
          id: rec.id,
          name: rec.name,
          price: rec.price,
          weight: '100–ì',
          quantity: 1,
          image: rec.image
        });
        renderAll();
      }
    }

    function selectStore(storeId) {
      selectedStore = storeId;
      document.querySelectorAll('.store-button').forEach((btn, index) => {
        const id = index === 0 ? 'small-store' : 'big-store';
        btn.classList.toggle('store-button--active', id === storeId);
      });
      renderDeliverySummary();
      renderCheckout();
    }

    function toggleDiscount() {
      if (canApplyDiscount()) {
        discountEnabled = !discountEnabled;
        renderCheckout();
      }
    }

    function clearCart() {
      if (cartItems.length > 0 && confirm('–û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É?')) {
        cartItems = [];
        discountEnabled = false;
        renderAll();
      }
    }

    function checkout() {
      if (cartItems.length === 0) return;
      const subtotal = getSubtotal();
      const delivery = getDeliveryPrice();
      const discount = getAppliedDiscount();
      const total = getTotalPrice();
      
      alert(`–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞:\n\n–¢–æ–≤–∞—Ä–æ–≤: ${getTotalItems()}\n–°—É–º–º–∞: ${formatPrice(subtotal)}\n–î–æ—Å—Ç–∞–≤–∫–∞: ${delivery === 0 ? '–±–µ—Å–ø–ª–∞—Ç–Ω–æ' : formatPrice(delivery)}\n–°–∫–∏–¥–∫–∞: ${discount > 0 ? `-${formatPrice(discount)}` : '–Ω–µ—Ç'}\n\n–ò—Ç–æ–≥–æ: ${formatPrice(total)}`);
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      // Add click handlers for recommendations
      document.querySelectorAll('.recommended-product__add').forEach((btn, index) => {
        btn.onclick = () => addRecommendedProduct(recommendations[index].id);
      });

      // Add click handlers for store buttons
      document.querySelectorAll('.store-button').forEach((btn, index) => {
        btn.onclick = () => selectStore(index === 0 ? 'small-store' : 'big-store');
      });

      // Add click handler for trash button
      document.querySelector('.header__action[alt="trash"]').onclick = clearCart;

      // Add click handler for checkout button
      document.querySelector('.checkout-button').onclick = checkout;

      // Update time
      const now = new Date();
      document.querySelector('.status-bar__time').textContent = 
        `${now.getHours()}:${now.getMinutes().toString().padStart(2, '0')}`;

      // Initial render
      renderAll();
    });
  </script>

  <style>
    /* Additional styles for business logic */
    .delivery-summary__progress-track {
      width: 100%;
      height: 8px;
      border-radius: 4px;
      background: #e5e5e5;
      overflow: hidden;
    }

    .delivery-summary__progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #4cd964 0%, #34c759 100%);
      border-radius: 4px;
      transition: width 0.3s ease;
    }

    .delivery-summary__progress-label--success {
      color: #34c759;
      font-weight: 600;
    }

    .cart-item__unit-price {
      font-size: 11px;
      color: var(--color-text-muted);
    }

    .cart-items__empty {
      padding: 40px 20px;
      text-align: center;
      color: var(--color-text-tertiary);
    }

    .cart-items__empty p {
      margin: 0;
      font-size: 16px;
    }

    .cart-items__empty-hint {
      font-size: 13px !important;
      margin-top: 8px !important;
    }

    .discount-section__toggle-wrapper {
      width: 51px;
      height: 31px;
      cursor: pointer;
      padding: 2px;
    }

    .discount-section__toggle-track {
      width: 100%;
      height: 100%;
      background: #e9e9eb;
      border-radius: 16px;
      position: relative;
      transition: background 0.3s;
    }

    .discount-section__toggle-wrapper--active .discount-section__toggle-track {
      background: #34c759;
    }

    .discount-section__toggle-thumb {
      width: 27px;
      height: 27px;
      background: white;
      border-radius: 50%;
      position: absolute;
      top: 2px;
      left: 2px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
      transition: transform 0.3s;
    }

    .discount-section__toggle-wrapper--active .discount-section__toggle-thumb {
      transform: translateX(20px);
    }

    .discount-section--disabled {
      opacity: 0.5;
    }

    .discount-section--disabled .discount-section__toggle-wrapper {
      cursor: not-allowed;
    }

    .checkout-button--disabled {
      background: #e5e5e5;
      border-color: #d5d5d5;
      cursor: not-allowed;
    }

    .checkout-button--disabled:hover {
      transform: none;
      box-shadow: none;
    }

    .checkout-button--disabled .checkout-button__time,
    .checkout-button--disabled .checkout-button__label,
    .checkout-button--disabled .checkout-button__total {
      color: #999;
    }
  </style>

  <script>
    // Dynamic device scaling to fit viewport
    (function() {
      const DEVICE_WIDTH = 428;
      const DEVICE_HEIGHT = 926;
      const PADDING = 60; // Small padding around device
      
      function setDeviceScale() {
        const wrapper = document.querySelector('.device-scale-wrapper');
        if (!wrapper) return;
        
        const availableHeight = window.innerHeight - PADDING;
        
        // Scale to fill available height (primary constraint for mobile device)
        const scale = availableHeight / DEVICE_HEIGHT;
        
        // Clamp between reasonable bounds
        const clampedScale = Math.max(0.5, Math.min(scale, 1.5));
        
        console.log('Viewport:', window.innerHeight, 'Scale:', clampedScale.toFixed(2));
        
        // Use transform for better rendering
        wrapper.style.transform = `scale(${clampedScale})`;
        wrapper.style.webkitTransform = `scale(${clampedScale})`;
      }
      
      // Initial call
      setDeviceScale();
      
      // Update on resize with debounce
      let resizeTimeout;
      window.addEventListener('resize', function() {
        clearTimeout(resizeTimeout);
        resizeTimeout = setTimeout(setDeviceScale, 100);
      });
      
      // Also call after DOM is fully loaded
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', setDeviceScale);
      }
    })();
  </script>
</body>
</html>

